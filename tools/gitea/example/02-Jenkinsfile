pipeline {
  agent any

  options {
      ansiColor('xterm')
  }

  // assumes that the Dagger Cloud token
  // is in a Jenkins credential named DAGGER_CLOUD_TOKEN
  environment {
    DAGGER_VERSION = "0.18.1"
    PATH = "/tmp/dagger/bin:$PATH"
    DAGGER_NO_NAG = 1
  }

  stages {
    stage("dagger") {
      steps {
        sh '''
          curl -fsSL https://dl.dagger.io/dagger/install.sh | BIN_DIR=/tmp/dagger/bin DAGGER_VERSION=$DAGGER_VERSION sh
          git clone http://gitea:3000/dagger/dagger-modules/ dagger-modules
          dagger call --verbose --debug -m ./dagger-modules/java/java-build publish --source=./ --repository "nexus/" --appName spring-petclinic --version 1.0.0
        '''
      }
    }
  }
}